#!/usr/bin/env node

const fs = require('fs');

/**
 * Configuration
 */
const conf = __dirname + '/../.env';

if (fs.existsSync(conf)) {
  require('node-env-file')(conf);
}

const debug = require('debug');
const log = debug('server');

if (!fs.existsSync(__dirname + '/../dist')) {
  throw new Error('You must run the server-side transpile build first (usually, gulp build)');
}

[
  'NODE_ENV',
  'HOST',
  'PORT',
  'SESSION_SECRET',
  'REDDIT_CONSUMER_KEY',
  'REDDIT_CONSUMER_SECRET',
]
  .forEach((param) => {
    if (!process.env[param]) {
      throw new Error('You must define ' + param + ' as an environment variable, or in .env');
    }
  });

/**
 * Start the application
 *
 * We're requiring for the side-effects here. This won't return.
 */
const app = require('./../dist/app');

